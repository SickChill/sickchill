name: Pypi

on:
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.sha }}
  cancel-in-progress: true

jobs:
  Release:
    runs-on: ubuntu-22.04
    if: github.actor == 'miigotu'
    steps:
      -
        name: Install poetry
        run: pipx install poetry
      -
        name: Checkout SickChill
        uses: actions/checkout@v3
        with:
          ref: master
          path: sickchill
      -
        name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'
          cache: 'poetry'
          check-latest: true
      -
        name: Publish
        env:
          TWINE_USERNAME: ${{ secrets.PYPI_USERNAME }}
          TWINE_PASSWORD: ${{ secrets.PYPI_PASSWORD }}
        working-directory: sickchill
        run: |
          git config --global user.name miigotu
          git config --global user.email miigotu@gmail.com
          poetry build
          poetry publish
